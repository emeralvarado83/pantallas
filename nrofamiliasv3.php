<?php
  function get_data() {
    return [
      'bolsa_familia' => [
        "2022" => [
          (object) ['mes' => 'Jan', 'familias' => 10000],
          (object) ['mes' => 'Fev', 'familias' => 11000],
          (object) ['mes' => 'Mar', 'familias' => 11500],
          (object) ['mes' => 'Abr', 'familias' => 11800],
          (object) ['mes' => 'Mai', 'familias' => 12000],
          (object) ['mes' => 'Jun', 'familias' => 12500],
          (object) ['mes' => 'Jul', 'familias' => 13000],
          (object) ['mes' => 'Ago', 'familias' => 13500],
          (object) ['mes' => 'Set', 'familias' => 14000],
          (object) ['mes' => 'Out', 'familias' => 14500],
          (object) ['mes' => 'Nov', 'familias' => 14800],
          (object) ['mes' => 'Dez', 'familias' => 15000],
        ],
        "2023" => [
          (object) ['mes' => 'Jan', 'familias' => 12000],
          (object) ['mes' => 'Fev', 'familias' => 13500],
          (object) ['mes' => 'Mar', 'familias' => 14200],
          (object) ['mes' => 'Abr', 'familias' => 15000],
          (object) ['mes' => 'Mai', 'familias' => 16000],
          (object) ['mes' => 'Jun', 'familias' => 15500],
          (object) ['mes' => 'Jul', 'familias' => 16500],
          (object) ['mes' => 'Ago', 'familias' => 17000],
          (object) ['mes' => 'Set', 'familias' => 17500],
          (object) ['mes' => 'Out', 'familias' => 18000],
          (object) ['mes' => 'Nov', 'familias' => 18500],
          (object) ['mes' => 'Dez', 'familias' => 19000],
        ],
        "2024" => [
          (object) ['mes' => 'Jan', 'familias' => 13000],
          (object) ['mes' => 'Fev', 'familias' => 14000],
          (object) ['mes' => 'Mar', 'familias' => 15000],
          (object) ['mes' => 'Abr', 'familias' => 16000],
          (object) ['mes' => 'Mai', 'familias' => 16500],
          (object) ['mes' => 'Jun', 'familias' => 17000],
          (object) ['mes' => 'Jul', 'familias' => 18000],
          (object) ['mes' => 'Ago', 'familias' => 18500],
          (object) ['mes' => 'Set', 'familias' => 19000],
          (object) ['mes' => 'Out', 'familias' => 19500],
          (object) ['mes' => 'Nov', 'familias' => 20000],
          (object) ['mes' => 'Dez', 'familias' => 20500],
        ]
      ],
      'ingresos_bajos' => [
        "2022" => [
          (object) ['mes' => 'Jan', 'familias' => 8000],
          (object) ['mes' => 'Fev', 'familias' => 8500],
          (object) ['mes' => 'Mar', 'familias' => 8700],
          (object) ['mes' => 'Abr', 'familias' => 8900],
          (object) ['mes' => 'Mai', 'familias' => 9000],
          (object) ['mes' => 'Jun', 'familias' => 9200],
          (object) ['mes' => 'Jul', 'familias' => 9400],
          (object) ['mes' => 'Ago', 'familias' => 9600],
          (object) ['mes' => 'Set', 'familias' => 9800],
          (object) ['mes' => 'Out', 'familias' => 10000],
          (object) ['mes' => 'Nov', 'familias' => 10200],
          (object) ['mes' => 'Dez', 'familias' => 10400],
        ],
        "2023" => [
          (object) ['mes' => 'Jan', 'familias' => 9000],
          (object) ['mes' => 'Fev', 'familias' => 9500],
          (object) ['mes' => 'Mar', 'familias' => 9800],
          (object) ['mes' => 'Abr', 'familias' => 10000],
          (object) ['mes' => 'Mai', 'familias' => 10500],
          (object) ['mes' => 'Jun', 'familias' => 10700],
          (object) ['mes' => 'Jul', 'familias' => 11000],
          (object) ['mes' => 'Ago', 'familias' => 11200],
          (object) ['mes' => 'Set', 'familias' => 11400],
          (object) ['mes' => 'Out', 'familias' => 11600],
          (object) ['mes' => 'Nov', 'familias' => 11800],
          (object) ['mes' => 'Dez', 'familias' => 12000],
        ],
        "2024" => [
          (object) ['mes' => 'Jan', 'familias' => 9500],
          (object) ['mes' => 'Fev', 'familias' => 9800],
          (object) ['mes' => 'Mar', 'familias' => 10000],
          (object) ['mes' => 'Abr', 'familias' => 10500],
          (object) ['mes' => 'Mai', 'familias' => 10800],
          (object) ['mes' => 'Jun', 'familias' => 11000],
          (object) ['mes' => 'Jul', 'familias' => 11500],
          (object) ['mes' => 'Ago', 'familias' => 11800],
          (object) ['mes' => 'Set', 'familias' => 12000],
          (object) ['mes' => 'Out', 'familias' => 12200],
          (object) ['mes' => 'Nov', 'familias' => 12400],
          (object) ['mes' => 'Dez', 'familias' => 12600],
        ]
      ],
      'ingresos_mayores' => [
        "2022" => [
          (object) ['mes' => 'Jan', 'familias' => 3000],
          (object) ['mes' => 'Fev', 'familias' => 3200],
          (object) ['mes' => 'Mar', 'familias' => 3300],
          (object) ['mes' => 'Abr', 'familias' => 3400],
          (object) ['mes' => 'Mai', 'familias' => 3500],
          (object) ['mes' => 'Jun', 'familias' => 3600],
          (object) ['mes' => 'Jul', 'familias' => 3700],
          (object) ['mes' => 'Ago', 'familias' => 3800],
          (object) ['mes' => 'Set', 'familias' => 3900],
          (object) ['mes' => 'Out', 'familias' => 4000],
          (object) ['mes' => 'Nov', 'familias' => 4100],
          (object) ['mes' => 'Dez', 'familias' => 4200],
        ],
        "2023" => [
          (object) ['mes' => 'Jan', 'familias' => 4000],
          (object) ['mes' => 'Fev', 'familias' => 4200],
          (object) ['mes' => 'Mar', 'familias' => 4400],
          (object) ['mes' => 'Abr', 'familias' => 4600],
          (object) ['mes' => 'Mai', 'familias' => 4800],
          (object) ['mes' => 'Jun', 'familias' => 5000],
          (object) ['mes' => 'Jul', 'familias' => 5200],
          (object) ['mes' => 'Ago', 'familias' => 5400],
          (object) ['mes' => 'Set', 'familias' => 5600],
          (object) ['mes' => 'Out', 'familias' => 5800],
          (object) ['mes' => 'Nov', 'familias' => 6000],
          (object) ['mes' => 'Dez', 'familias' => 6200],
        ],
        "2024" => [
          (object) ['mes' => 'Jan', 'familias' => 4500],
          (object) ['mes' => 'Fev', 'familias' => 4700],
          (object) ['mes' => 'Mar', 'familias' => 4900],
          (object) ['mes' => 'Abr', 'familias' => 5100],
          (object) ['mes' => 'Mai', 'familias' => 5300],
          (object) ['mes' => 'Jun', 'familias' => 5500],
          (object) ['mes' => 'Jul', 'familias' => 5700],
          (object) ['mes' => 'Ago', 'familias' => 5900],
          (object) ['mes' => 'Set', 'familias' => 6100],
          (object) ['mes' => 'Out', 'familias' => 6300],
          (object) ['mes' => 'Nov', 'familias' => 6500],
          (object) ['mes' => 'Dez', 'familias' => 6700],
        ]
      ]
    ];
  }

  $data = get_data();
?>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gráficos con filtros por año</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    section {
      margin-bottom: 60px;
    }
    canvas {
      max-width: 800px;
      width: 100%;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    select {
      margin-bottom: 15px;
      padding: 5px;
    }
  </style>
</head>
<body>

  <h2>Indicadores do Cadastro Único por Ano</h2>
  <label for="anio_global">Selecione o ano:</label>
  <select id="anio_global">
    <option value="2022">2022</option>
    <option value="2023" selected>2023</option>
    <option value="2024">2024</option>
  </select>

  <script>
    const datosPorGrafico = <?php echo json_encode($data); ?>;

    function construirDataset(datos, anio, label, color) {
      const registros = datos[anio];
      return {
        labels: registros.map(d => d.mes),
        datasets: [{
          label: `${label} (${anio})`,
          data: registros.map(d => d.familias),
          backgroundColor: color[0],
          borderColor: color[1],
          borderWidth: 1
        }]
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      const config = [
        {
          id: 'bolsa',
          titulo: 'Famílias cadastradas no Bolsa de Família',
          dataKey: 'bolsa_familia',
          colores: ['rgba(54, 162, 235, 0.6)', 'rgba(54, 162, 235, 1)']
        },
        {
          id: 'bajos',
          titulo: 'Famílias com rendimentos abaixo do salário mínimo',
          dataKey: 'ingresos_bajos',
          colores: ['rgba(255, 159, 64, 0.6)', 'rgba(255, 159, 64, 1)']
        },
        {
          id: 'mayores',
          titulo: 'Famílias com rendimentos acima do salário mínimo',
          dataKey: 'ingresos_mayores',
          colores: ['rgba(75, 192, 192, 0.6)', 'rgba(75, 192, 192, 1)']
        }
      ];

      const charts = {};

      config.forEach(cfg => {
        const seccion = document.createElement('section');

        const titulo = document.createElement('h3');
        titulo.textContent = cfg.titulo;
        seccion.appendChild(titulo);

        const canvas = document.createElement('canvas');
        canvas.id = `grafico_${cfg.id}`;
        seccion.appendChild(canvas);

        document.body.appendChild(seccion);

        const ctx = canvas.getContext('2d');
        charts[cfg.id] = new Chart(ctx, {
          type: 'bar',
          data: construirDataset(datosPorGrafico[cfg.dataKey], '2024', cfg.titulo, cfg.colores),
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Número de famílias' }
              },
              x: {
                title: { display: true, text: 'Meses' }
              }
            }
          }
        });
      });

      const selectorGlobal = document.getElementById('anio_global');
      selectorGlobal.addEventListener('change', () => {
        const anio = selectorGlobal.value;
        config.forEach(cfg => {
          const chart = charts[cfg.id];
          chart.data = construirDataset(datosPorGrafico[cfg.dataKey], anio, cfg.titulo, cfg.colores);
          chart.update();
        });
      });
    });
  </script>
</body>
</html>
